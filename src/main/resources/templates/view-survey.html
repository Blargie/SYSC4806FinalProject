<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>View Survey</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <!-- Survey Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 th:text="${survey.surveyName}">Survey Name</h2>
        <div>
            <span class="badge"
                  th:classappend="${survey.isOpen ? 'bg-success' : 'bg-danger'}"
                  th:text="${survey.isOpen ? 'Open' : 'Closed'}">Status</span>
        </div>
    </div>

    <!-- Questions List -->
    <div class="questions-container">
        <div th:if="${#lists.isEmpty(survey.surveyQuestions)}" class="alert alert-info">
            This survey has no questions.
        </div>

        <div th:each="question, questionStat : ${survey.surveyQuestions}" class="card mb-3">
            <div class="card-body">
                <h5 class="card-title" th:text="${'Question ' + (questionStat.index + 1)}">Question</h5>
                <p class="card-text" th:text="${question.questionText}">Question text goes here</p>

                <!-- Multiple Choice Question -->
                <div th:if="${question.type == 'MULTIPLE_CHOICE'}" class="multiple-choice-container">
                    <div class="form-group">
                        <div th:each="index : ${#numbers.sequence(0, question.numAnswers - 1)}"
                             class="form-check">
                            <input class="form-check-input" type="radio"
                                   th:name="'question-' + ${question.questionId}"
                                   th:value="${index}" disabled>
                            <label class="form-check-label"
                                   th:text="${'Option ' + T(java.lang.Character).toString(65 + index)}">
                                Option
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Text Question -->
                <div th:if="${question.type == 'TEXT'}" class="text-question-container">
                    <div class="form-group">
                        <textarea class="form-control" rows="3" disabled
                                  th:maxlength="${question.charLimit}"
                                  th:placeholder="'Maximum ' + ${question.charLimit} + ' characters'">
                        </textarea>
                    </div>
                </div>

                <!-- Numeric Range Question -->
                <div th:if="${question.type == 'NUMERIC_RANGE'}" class="numeric-range-container">
                    <div class="form-group">
                        <input type="range" class="form-range" disabled
                               th:min="${question.lowerBound}"
                               th:max="${question.upperBound}">
                        <div class="d-flex justify-content-between">
                            <span th:text="${question.lowerBound}">Min</span>
                            <span th:text="${question.upperBound}">Max</span>
                        </div>
                    </div>
                </div>

                <!-- Question Type Badge -->
                <div class="mt-3">
                    <span class="badge bg-secondary" th:text="${question.type}">Question Type</span>
                    <span th:if="${question.type == 'TEXT'}"
                          class="badge bg-info"
                          th:text="'Max length: ' + ${question.charLimit}">
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="mt-4 d-flex gap-2">
        <a href="/api/surveys/list" class="btn btn-secondary">Back to Surveys</a>
        <a th:if="${survey.isOpen}"
           th:href="@{'/api/surveys/' + ${survey.surveyId} + '/answer'}"
           class="btn btn-primary">Answer Survey</a>
        <button th:if="${survey.isOpen}"
                onclick="closeSurvey()"
                class="btn btn-warning">Close Survey</button>
        <button onclick="deleteSurvey()"
                class="btn btn-danger">Delete Survey</button>
    </div>
</div>

<script>
    async function closeSurvey() {
        if (!confirm('Are you sure you want to close this survey?')) {
            return;
        }

        try {
            const response = await fetch(`/api/surveys/${survey.surveyId}/close`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                window.location.reload();
            } else {
                alert('Failed to close survey');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error closing survey');
        }
    }

    async function deleteSurvey() {
        if (!confirm('Are you sure you want to delete this survey? This action cannot be undone.')) {
            return;
        }

        try {
            const response = await fetch(`/api/surveys/${survey.surveyId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                window.location.href = '/api/surveys/list';
            } else {
                alert('Failed to delete survey');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error deleting survey');
        }
    }
</script>
</body>
</html>